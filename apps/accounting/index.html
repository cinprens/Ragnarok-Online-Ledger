<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ragnarok Accounting Ledger</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-title">Sections</div>
      <nav class="sidebar-nav">
        <button class="nav-link is-active" type="button" data-section-link="section-dashboard">Dashboard</button>
        <button class="nav-link" type="button" data-section-link="section-accounts">Accounts</button>
        <button class="nav-link" type="button" data-section-link="section-vending">Vending Stalls</button>
        <button class="nav-link" type="button" data-section-link="section-loans">Loans</button>
        <button class="nav-link" type="button" data-section-link="section-share">Share Codes</button>
        <button class="nav-link" type="button" data-section-link="section-backup">Backup Center</button>
        <button class="nav-link" type="button" data-section-link="section-zeny">Zeny Vaults</button>
        <button class="nav-link" type="button" data-section-link="section-finder">Item Finder</button>
        <button class="nav-link" type="button" data-section-link="section-inventory">Inventory</button>
        <button class="nav-link" type="button" data-section-link="section-guide">User Guide</button>
      </nav>
      <div class="sidebar-block">
        <div class="sidebar-label">Active Account</div>
        <select id="active-account-select"></select>
        <div class="sidebar-meta" id="active-account-meta"></div>
      </div>
    </aside>

    <main class="content">
      <section class="section is-active" id="section-dashboard" data-section>
        <header class="hero">
          <div class="hero-text">
            <div class="hero-eyebrow">Ragnarok Ledger</div>
            <h1>Accounting Vault</h1>
            <p>Track Zeny and inventory value with manual pricing (offline mode).</p>
          </div>
          <div class="hero-meta">
            <div class="meta-card">
              <span>Data Source</span>
              <strong>Offline</strong>
            </div>
            <div class="meta-card">
              <span>Snapshot</span>
              <strong id="meta-updated">Local</strong>
            </div>
            <div class="meta-card">
              <span>Items</span>
              <strong id="meta-count">0</strong>
            </div>
          </div>
          <div class="hero-actions">
            <button class="ghost" id="exportBtn">Export</button>
            <label class="ghost file-btn">
              Import
              <input type="file" id="importFile" accept="application/json">
            </label>
            <button class="danger" id="resetBtn">Reset</button>
          </div>
        </header>

        <section class="stats">
          <div class="stat-card">
            <span>All Accounts Zeny</span>
            <strong id="total-zeny-all">0</strong>
          </div>
          <div class="stat-card">
            <span>Total Zeny</span>
            <strong id="total-zeny">0</strong>
          </div>
          <div class="stat-card">
            <span>Inventory Value</span>
            <strong id="inventory-value">0</strong>
          </div>
          <div class="stat-card highlight">
            <span>Net Worth</span>
            <strong id="net-worth">0</strong>
          </div>
          <div class="stat-card">
            <span>Items Owned</span>
            <strong id="items-owned">0</strong>
          </div>
        </section>

        <section class="overview">
          <div class="panel overview-panel">
            <div class="panel-header">
              <h2>Portfolio Overview</h2>
              <p>Inventory value distribution by category.</p>
            </div>
            <div class="chart-list" id="group-chart"></div>
          </div>
          <div class="panel overview-panel">
            <div class="panel-header">
              <h2>Top Holdings</h2>
              <p>Highest value items in your inventory.</p>
            </div>
            <div class="top-items" id="top-items"></div>
          </div>
        </section>
      </section>

      <section class="section" id="section-accounts" data-section>
        <div class="panel account-panel">
          <div class="panel-header">
            <h2>Accounts</h2>
            <p>Track Zeny and inventory per account.</p>
          </div>
          <div class="account-toolbar">
            <div class="account-list" id="account-list"></div>
            <div class="account-actions">
              <input type="text" id="account-name" placeholder="Account name">
              <button class="ghost" id="account-add">Add</button>
              <button class="ghost" id="account-rename">Rename</button>
              <button class="danger" id="account-delete">Delete</button>
            </div>
          </div>
          <div class="character-panel">
            <div class="character-header">
              <strong>Characters</strong>
              <span id="character-count">0/7</span>
            </div>
            <div class="character-add">
              <input type="text" id="character-name" placeholder="Character name">
              <input type="number" id="character-zeny" min="0" step="1" placeholder="Zeny">
              <button class="ghost" id="character-add">Add Character</button>
            </div>
            <div class="character-list" id="character-list"></div>
          </div>
          <div class="global-search">
            <input type="text" id="global-search" placeholder="Search item across all accounts...">
          </div>
          <div class="global-results" id="global-results"></div>
        </div>
      </section>

      <section class="section" id="section-vending" data-section>
        <div class="panel vending-panel">
          <div class="panel-header">
            <h2>Vending Stalls</h2>
            <p>Open vending per character (max 12 items each).</p>
          </div>
          <div class="vending-toolbar">
            <input type="text" id="vending-character" placeholder="Character name">
            <button class="ghost" id="vending-open">Open Vending</button>
          </div>
          <div class="vending-list" id="vending-list"></div>
        </div>
      </section>

      <section class="section" id="section-loans" data-section>
        <div class="panel loans-panel">
          <div class="panel-header">
            <h2>Loans</h2>
            <p>Track items you lent to other players.</p>
          </div>
          <div class="loan-form">
            <input type="text" id="loan-person" placeholder="Player name">
            <input type="text" id="loan-item" placeholder="Item name...">
            <input type="number" id="loan-qty" min="1" value="1">
            <input type="date" id="loan-date">
            <input type="text" id="loan-note" placeholder="Note (optional)">
            <button class="ghost" id="loan-add">Add Loan</button>
          </div>
          <div class="loan-suggestions" id="loan-suggestions"></div>
          <div class="loan-status" id="loan-status"></div>
          <div class="loan-toolbar">
            <select id="loan-filter">
              <option value="all">All</option>
              <option value="active">Active</option>
              <option value="returned">Returned</option>
            </select>
            <div class="loan-summary" id="loan-summary"></div>
          </div>
          <div class="loan-list" id="loan-list"></div>
        </div>
      </section>

      <section class="section" id="section-share" data-section>
        <div class="panel share-panel">
          <div class="panel-header">
            <h2>Share Codes</h2>
            <p>Share items with friends using a simple hash code.</p>
          </div>
          <div class="share-grid">
            <div class="share-card">
              <h3>Create Code</h3>
              <div class="share-form">
                <input type="text" id="share-from" placeholder="Your name (optional)">
                <input type="text" id="share-item" placeholder="Item name...">
                <input type="number" id="share-qty" min="1" value="1">
                <input type="text" id="share-price" placeholder="Price (optional)">
                <input type="text" id="share-note" placeholder="Item note (optional)">
                <button class="ghost" id="share-add">Add Item</button>
              </div>
              <div class="share-suggestions" id="share-suggestions"></div>
              <div class="share-status" id="share-status"></div>
              <div class="share-list" id="share-list"></div>
              <textarea id="share-general-note" rows="3" placeholder="General note (optional)"></textarea>
              <div class="share-actions">
                <button class="ghost" id="share-generate">Generate Code</button>
                <button class="ghost" id="share-copy">Copy</button>
              </div>
              <div class="share-meta" id="share-generated-meta"></div>
              <textarea id="share-code" rows="4" placeholder="Share code will appear here..."></textarea>
            </div>
            <div class="share-card">
              <h3>Use Code</h3>
              <textarea id="share-import" rows="6" placeholder="Paste a share code here..."></textarea>
              <div class="share-actions">
                <button class="ghost" id="share-apply">Preview</button>
                <button class="ghost" id="share-import-btn">Import Items</button>
              </div>
              <div class="share-meta" id="share-meta"></div>
              <div class="share-preview" id="share-preview"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="section-backup" data-section>
        <div class="panel backup-panel">
          <div class="panel-header">
            <h2>Backup Center</h2>
            <p>Protect your data with regular backups.</p>
          </div>
          <div class="backup-status">
            <div class="backup-card">
              <span>Last Backup</span>
              <strong id="backup-last">Never</strong>
            </div>
            <div class="backup-warning" id="backup-warning"></div>
          </div>
          <div class="backup-actions">
            <button class="ghost" id="backup-export">Download Backup</button>
            <label class="ghost file-btn">
              Import
              <input type="file" id="backup-import" accept="application/json">
            </label>
          </div>
          <div class="backup-autosave">
            <div class="backup-autosave-info">
              <strong>Always Save to File</strong>
              <div class="muted">Chrome/Edge only. Keeps a live backup on disk.</div>
            </div>
            <div class="backup-autosave-actions">
              <button class="ghost" id="backup-autosave-enable">Always Save to File</button>
              <button class="ghost" id="backup-autosave-disable">Disable</button>
            </div>
            <div class="backup-autosave-status" id="backup-autosave-status"></div>
          </div>
        </div>
      </section>

      <section class="section" id="section-zeny" data-section>
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">
              <h2>Zeny Vaults</h2>
              <p>Split your Zeny across storages.</p>
            </div>
            <div class="panel-actions">
              <div class="inline-label">
                Account
                <select id="zeny-account-select"></select>
              </div>
              <div class="inline-label">
                Character
                <select id="zeny-character-select"></select>
              </div>
            </div>
          </div>
          <div class="field-grid">
            <label>
              Wallet
              <input type="number" id="zeny-wallet" min="0" step="1" placeholder="0">
            </label>
            <label>
              Storage
              <input type="number" id="zeny-storage" min="0" step="1" placeholder="0">
            </label>
            <label>
              Merchant
              <input type="number" id="zeny-merchant" min="0" step="1" placeholder="0">
            </label>
            <label>
              Bank
              <input type="number" id="zeny-bank" min="0" step="1" placeholder="0">
            </label>
            <label>
              Other
              <input type="number" id="zeny-other" min="0" step="1" placeholder="0">
            </label>
          </div>
          <div class="character-zeny-panel">
            <label>
              Character Zeny
              <input type="number" id="zeny-character-value" min="0" step="1" placeholder="0">
            </label>
          </div>
        </div>
      </section>

      <section class="section" id="section-finder" data-section>
        <div class="panel">
          <div class="panel-header">
            <h2>Item Finder</h2>
            <p>Search and add items to your inventory.</p>
          </div>
          <div class="search-bar">
            <input type="text" id="item-search" placeholder="Search item name...">
          </div>
          <div class="filters">
            <select id="filter-type">
              <option value="">All Types</option>
            </select>
            <select id="filter-category">
              <option value="">All Categories</option>
            </select>
          </div>
          <div class="results" id="search-results"></div>
        </div>
      </section>

      <section class="section" id="section-inventory" data-section>
        <div class="panel">
          <div class="panel-header">
            <h2>Inventory</h2>
            <p>Adjust quantity, override price, and track total value.</p>
          </div>
          <div class="inventory-toolbar">
            <div class="inventory-search">
              <input type="text" id="inventory-search" placeholder="Search your inventory...">
            </div>
            <div class="inventory-actions">
              <span id="inventory-summary">0 items</span>
              <button class="ghost" id="clearInventory">Clear</button>
            </div>
          </div>
          <div class="group-filter" id="group-filter"></div>
          <div class="inventory" id="inventory-list"></div>
        </div>
      </section>

      <section class="section" id="section-guide" data-section>
        <div class="panel guide-panel">
          <div class="panel-header">
            <h2>User Guide</h2>
            <p>How to use Ragnarok Accounting Ledger (offline mode).</p>
          </div>
          <div class="guide-grid">
            <div class="guide-block">
              <h3>Quick Start</h3>
              <ol class="guide-steps">
                <li>Open Accounts, type a name, then click Add.</li>
                <li>Add characters and their Zeny (max 7 characters per account).</li>
                <li>Go to Zeny Vaults and fill Wallet, Storage, Merchant, Bank, and Other.</li>
                <li>Use Item Finder to search items and click Add.</li>
                <li>In Inventory, adjust quantities and set Manual price if needed.</li>
                <li>Check Dashboard for totals and export a backup.</li>
              </ol>
            </div>
            <div class="guide-block">
              <h3>Core Sections</h3>
              <ul class="guide-list">
                <li>Dashboard: overall Zeny, inventory value, net worth, and top holdings.</li>
                <li>Accounts: manage accounts, characters, and global item search.</li>
                <li>Loans: record which items you lent to other players.</li>
                <li>Share Codes: generate a hash to share items between apps.</li>
                <li>Backup Center: export, import, and auto-save your data.</li>
                <li>Zeny Vaults: split Zeny across storage types and characters.</li>
                <li>Item Finder: search by name, type, and category to add items.</li>
                <li>Inventory: edit quantity, set manual prices, and filter by group.</li>
                <li>Vending Stalls: track shop items, sales, tax, and net.</li>
              </ul>
            </div>
            <div class="guide-block">
              <h3>Vending Workflow</h3>
              <ol class="guide-steps">
                <li>Open Vending Stalls, enter a character name, then click Open Vending.</li>
                <li>Add items by name, pick a suggestion, and set qty and price.</li>
                <li>Each stall can hold up to 12 items.</li>
                <li>Click Sell to log a sale. A 5% tax applies when unit price is above 10,000,000.</li>
              </ol>
            </div>
            <div class="guide-block">
              <h3>Backups & Reset</h3>
              <ul class="guide-list">
                <li>Export downloads <code>ragnarok-ledger.json</code> with all accounts and items.</li>
                <li>Import restores data from a previous export.</li>
                <li>Reset wipes everything in the current browser.</li>
              </ul>
            </div>
            <div class="guide-block">
              <h3>Limits & Notes</h3>
              <ul class="guide-list">
                <li>Data is stored in the browser local storage. Export for backups.</li>
                <li>Setting an inventory quantity to 0 removes the item.</li>
                <li>Manual price overrides the item value used in totals.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="data/items-data.js"></script>
  <script src="app.js"></script>
</body>
</html>
